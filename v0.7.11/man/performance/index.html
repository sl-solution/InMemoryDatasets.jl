<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Performance tips · InMemoryDatasets</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">InMemoryDatasets</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../basics/">First Steps</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../missing/">Missing Values</a></li><li><a class="tocitem" href="../formats/">Formats</a></li><li><a class="tocitem" href="../map/">Call functions on each observation</a></li><li><a class="tocitem" href="../byrow/">Row-wise operations</a></li><li><a class="tocitem" href="../modify/">Transform columns</a></li><li><a class="tocitem" href="../filter/">Filter observations</a></li><li><a class="tocitem" href="../sorting/">Sort</a></li><li><a class="tocitem" href="../grouping/">Group observations</a></li><li><a class="tocitem" href="../aggregation/">Aggregation</a></li><li><a class="tocitem" href="../transpose/">Transpose data</a></li><li><a class="tocitem" href="../joins/">Joins</a></li></ul></li><li><a class="tocitem" href="../gallery/">Gallery</a></li><li class="is-active"><a class="tocitem" href>Performance tips</a><ul class="internal"><li><a class="tocitem" href="#Make-use-of-provided-APIs"><span>Make use of provided APIs</span></a></li><li><a class="tocitem" href="#Avoid-pushing-single-values"><span>Avoid pushing single values</span></a></li><li><a class="tocitem" href="#Avoid-using-String-type-for-large-data-sets"><span>Avoid using <code>String</code> type for large data sets</span></a></li><li><a class="tocitem" href="#Choose-groupby-or-gatherby-based-on-the-problem-in-hand"><span>Choose <code>groupby</code> or <code>gatherby</code> based on the problem in hand</span></a></li><li><a class="tocitem" href="#Beware-that-every-column-must-support-missings"><span>Beware that every column must support <code>missings</code></span></a></li><li><a class="tocitem" href="#Master-byrow"><span>Master <code>byrow</code></span></a></li><li><a class="tocitem" href="#Don&#39;t-avoid-for-loops!"><span>Don&#39;t avoid <code>for loops</code>!</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Performance tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Performance tips</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sl-solution/InMemoryDatasets.jl/blob/master/docs/src/man/performance.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Performance-tips"><a class="docs-heading-anchor" href="#Performance-tips">Performance tips</a><a id="Performance-tips-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-tips" title="Permalink"></a></h1><p>This section contains some performance tips which can improve the experience of working with InMemoryDatasets. These tips are specially important when the package is handling huge data.</p><h2 id="Make-use-of-provided-APIs"><a class="docs-heading-anchor" href="#Make-use-of-provided-APIs">Make use of provided APIs</a><a id="Make-use-of-provided-APIs-1"></a><a class="docs-heading-anchor-permalink" href="#Make-use-of-provided-APIs" title="Permalink"></a></h2><p>Every data manipulation, data cleaning, data wrangling should be done via the provided APIs, i.e. don&#39;t modify columns out of those APIs. For example, changing values of a column or creating a new column using a <code>for loop</code> must be done via <code>modify!</code>, <code>modify</code> or similar functions,</p><pre><code class="language-julia-repl hljs">julia&gt; ds = Dataset(x = [1,2,1,2], y = [1.5,3.4,-10,2.3])
4×2 Dataset
 Row │ x         y        
     │ identity  identity
     │ Int64?    Float64?
─────┼────────────────────
   1 │        1       1.5
   2 │        2       3.4
   3 │        1     -10.0
   4 │        2       2.3

julia&gt; function r_f!(x)
           for i in 2:length(x)
               if x[i-1] &lt; 2.0
                   x[i] = missing
               end
           end
           x
       end
r_f! (generic function with 1 method)

julia&gt; modify!(groupby(ds, 1), :y=&gt;r_f!)
4×2 Dataset
 Row │ x         y         
     │ identity  identity  
     │ Int64?    Float64?  
─────┼─────────────────────
   1 │        1        1.5
   2 │        2        3.4
   3 │        1  missing   
   4 │        2        2.3

julia&gt; map!(filter(ds, :x, by = ==(2), view = true), x-&gt;x+2, :x);

julia&gt; ds
4×2 Dataset
 Row │ x         y         
     │ identity  identity  
     │ Int64?    Float64?  
─────┼─────────────────────
   1 │        1        1.5
   2 │        4        3.4
   3 │        1  missing   
   4 │        4        2.3</code></pre><h2 id="Avoid-pushing-single-values"><a class="docs-heading-anchor" href="#Avoid-pushing-single-values">Avoid pushing single values</a><a id="Avoid-pushing-single-values-1"></a><a class="docs-heading-anchor-permalink" href="#Avoid-pushing-single-values" title="Permalink"></a></h2><p>This is because every single change in a data set will trigger multiple functions (InMemoryDatasets changes the modified date, whether the format should be dropped, ...) and the overhead will be significant.</p><h2 id="Avoid-using-String-type-for-large-data-sets"><a class="docs-heading-anchor" href="#Avoid-using-String-type-for-large-data-sets">Avoid using <code>String</code> type for large data sets</a><a id="Avoid-using-String-type-for-large-data-sets-1"></a><a class="docs-heading-anchor-permalink" href="#Avoid-using-String-type-for-large-data-sets" title="Permalink"></a></h2><p><code>String</code> in julia causes significant Garbage Collection overhead. InMemoryDatasets needs to create many intermediate arrays during its operations and <code>GC</code> degrades its performance. Use <code>PooledArrays</code> or fixed width Strings for such scenarios.</p><h2 id="Choose-groupby-or-gatherby-based-on-the-problem-in-hand"><a class="docs-heading-anchor" href="#Choose-groupby-or-gatherby-based-on-the-problem-in-hand">Choose <code>groupby</code> or <code>gatherby</code> based on the problem in hand</a><a id="Choose-groupby-or-gatherby-based-on-the-problem-in-hand-1"></a><a class="docs-heading-anchor-permalink" href="#Choose-groupby-or-gatherby-based-on-the-problem-in-hand" title="Permalink"></a></h2><p>Beside the order of the output, note that <code>groupby</code> and <code>gatherby</code> use very different approaches for grouping observations. <code>groupby/!</code> utilises the multithreading efficiently however, <code>gatherby</code> exploits the fast path of computations for some specific operations and usually has lower memory footprint.</p><blockquote><p>InMemoryDatasets passes a copy of columns to <code>combine</code> when users pass a groupped data set created by <code>groupby</code> or <code>gatherby</code> as its first argument, thus, it is safe to mutate the columns in-place. However, when a groupped data set is created by <code>groupby!</code> then mutating in-place inside the <code>combine</code> function is not safe, because in this case, InMemoryDatasets passes the columns directly to <code>combine</code>.</p></blockquote><h2 id="Beware-that-every-column-must-support-missings"><a class="docs-heading-anchor" href="#Beware-that-every-column-must-support-missings">Beware that every column must support <code>missings</code></a><a id="Beware-that-every-column-must-support-missings-1"></a><a class="docs-heading-anchor-permalink" href="#Beware-that-every-column-must-support-missings" title="Permalink"></a></h2><p>Every columns in InMemoryDatasets will be converted to support <code>missing</code>. Thus, it is wise to create the vectors in that way. For example, if you load an <code>Arrow</code> file which its columns don&#39;t support missing values, InMemoryDatasets materialises the whole file, but if they already support missing values, InMemoryDatasets uses the memory map for accessing values.</p><h2 id="Master-byrow"><a class="docs-heading-anchor" href="#Master-byrow">Master <code>byrow</code></a><a id="Master-byrow-1"></a><a class="docs-heading-anchor-permalink" href="#Master-byrow" title="Permalink"></a></h2><p><code>byrow</code> uses efficient algorithms to apply functions on each row of a data set. It is fine tuned for some specific functions, which are listed in its docstring. And it is the core function for filtering observations, so mastering its capabilities is essential for working with data sets.</p><h2 id="Don&#39;t-avoid-for-loops!"><a class="docs-heading-anchor" href="#Don&#39;t-avoid-for-loops!">Don&#39;t avoid <code>for loops</code>!</a><a id="Don&#39;t-avoid-for-loops!-1"></a><a class="docs-heading-anchor-permalink" href="#Don&#39;t-avoid-for-loops!" title="Permalink"></a></h2><p>Julia is very fast program and users don&#39;t need to think about vectorisation for the sake of performance. Actually, using loop usually is a better choice and reduces the memory allocations. Thus, users don&#39;t need to avoid <code>for loops</code> and are encouraged to use them. However, remember to wrap your for loops in a function and pass the function to an appropriate API in InMemoryDatasets, e.g. <code>modify!</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gallery/">« Gallery</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 18 November 2022 08:41">Friday 18 November 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
