<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Aggregation · InMemoryDatasets</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">InMemoryDatasets</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../basics/">First Steps</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../missing/">Missing Values</a></li><li><a class="tocitem" href="../formats/">Formats</a></li><li><a class="tocitem" href="../map/">Call functions on each observation</a></li><li><a class="tocitem" href="../byrow/">Row-wise operations</a></li><li><a class="tocitem" href="../modify/">Transform columns</a></li><li><a class="tocitem" href="../filter/">Filter observations</a></li><li><a class="tocitem" href="../sorting/">Sort</a></li><li><a class="tocitem" href="../grouping/">Group observations</a></li><li class="is-active"><a class="tocitem" href>Aggregation</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#combine"><span><code>combine</code></span></a></li></ul></li><li><a class="tocitem" href="../transpose/">Transpose data</a></li><li><a class="tocitem" href="../joins/">Joins</a></li></ul></li><li><a class="tocitem" href="../gallery/">Gallery</a></li><li><a class="tocitem" href="../performance/">Performance tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Aggregation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Aggregation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sl-solution/InMemoryDatasets.jl/blob/master/docs/src/man/aggregation.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Aggregation"><a class="docs-heading-anchor" href="#Aggregation">Aggregation</a><a id="Aggregation-1"></a><a class="docs-heading-anchor-permalink" href="#Aggregation" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>In previous sections we discuss the main functions (<code>groupby!</code>, <code>groupby</code>, and <code>gatherby</code>) to group observations in a data set. In this section we introduce a function which can be used to apply a function on each group of observations.</p><h2 id="combine"><a class="docs-heading-anchor" href="#combine"><code>combine</code></a><a id="combine-1"></a><a class="docs-heading-anchor-permalink" href="#combine" title="Permalink"></a></h2><p><code>combine</code> is a function which accepts a grouped data set - created by <code>groupby!</code>, <code>groupby</code>, or <code>gatherby</code> - and a set of operations in the form of <code>cols =&gt; fun</code>, where <code>cols</code> is a column selector, and applies <code>fun</code> on each columns in <code>cols</code>. The operations can be passed as <code>col =&gt; fun =&gt; :newname</code> if user likes to have a specific column name for the output column. All columns selected by <code>cols</code> are assumed to be referring to the same columns in the input data set. However, when the passed <code>fun</code> is a <code>byrow</code> function then <code>combine</code> assumes every column in <code>cols</code> are referring to the existing columns in the output data set. Thus, unlike <code>modify!</code>/<code>modify</code>, <code>combine</code> only can access to the existing columns in the output data set when the <code>fun</code> is a <code>byrow</code> function.</p><p>The order of the output data set depends on the passed data set, i.e. for <code>groupby</code> the order of the output is sorted order of the grouping columns, and for <code>gatherby</code> data set the order of the output is based on the appearance of observations in the original data set. Since for most situations, the stability of grouping is not needed, passing <code>stable = false</code> in <code>groupby/gatherby</code> can improve the performance, but when <code>stable = false</code> for <code>gatherby</code>, the order of the output is undefined.</p><p>By default, <code>combine</code> outputs the grouping columns in the final result, however, passing <code>dropgroupcols = true</code> removes them from the final output.</p><blockquote><p>By default <code>combine</code> send each group of data to different threads for processing (multithreaded processing), however, passing <code>threads = false</code> changes this.</p></blockquote><h3 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h3><pre><code class="language-julia-repl hljs">julia&gt; ds = Dataset(g = [1,2,1,2,1,2], x = 1:6)
6×2 Dataset
 Row │ g         x        
     │ identity  identity
     │ Int64?    Int64?   
─────┼────────────────────
   1 │        1         1
   2 │        2         2
   3 │        1         3
   4 │        2         4
   5 │        1         5
   6 │        2         6

julia&gt; combine(groupby(ds, :g), :x=&gt;[IMD.sum, mean])
2×3 Dataset
 Row │ g         sum_x     mean_x   
     │ identity  identity  identity
     │ Int64?    Int64?    Float64?
─────┼──────────────────────────────
   1 │        1         9       3.0
   2 │        2        12       4.0

julia&gt; combine(gatherby(ds, :g), :x =&gt; [IMD.maximum, IMD.minimum], 2:3 =&gt; byrow(-) =&gt; :range)
2×4 Dataset
 Row │ g         maximum_x  minimum_x  range    
     │ identity  identity   identity   identity
     │ Int64?    Int64?     Int64?     Int64?   
─────┼──────────────────────────────────────────
   1 │        1          5          1         4
   2 │        2          6          2         4

julia&gt; ds = Dataset(rand(1:10, 10, 4), :auto)
10×4 Dataset
 Row │ x1        x2        x3        x4       
     │ identity  identity  identity  identity
     │ Int64?    Int64?    Int64?    Int64?   
─────┼────────────────────────────────────────
   1 │        9         1         6         3
   2 │       10         7        10         6
   3 │        7         7         3         9
   4 │        9         4        10         8
   5 │        7         3         4         5
   6 │        2         6         5         6
   7 │        1         6         6         1
   8 │       10         2         7         6
   9 │        5        10         9         6
  10 │        1         1         3         4

julia&gt; combine(gatherby(ds, 1), r&quot;x&quot; =&gt; IMD.sum)
6×5 Dataset
 Row │ x1        sum_x1    sum_x2    sum_x3    sum_x4   
     │ identity  identity  identity  identity  identity
     │ Int64?    Int64?    Int64?    Int64?    Int64?   
─────┼──────────────────────────────────────────────────
   1 │        9        18         5        16        11
   2 │       10        20         9        17        12
   3 │        7        14        10         7        14
   4 │        2         2         6         5         6
   5 │        1         2         7         9         5
   6 │        5         5        10         9         6

julia&gt; ds = Dataset(g = [1,2,1,2,1,2], x = 1:6)
6×2 Dataset
 Row │ g         x        
     │ identity  identity
     │ Int64?    Int64?   
─────┼────────────────────
   1 │        1         1
   2 │        2         2
   3 │        1         3
   4 │        2         4
   5 │        1         5
   6 │        2         6

julia&gt; combine(gatherby(ds, :g), :x=&gt;[IMD.maximum, IMD.minimum], 2:3=&gt;byrow(-)=&gt;:range, dropgroupcols = true)
2×3 Dataset
 Row │ maximum_x  minimum_x  range    
     │ identity   identity   identity
     │ Int64?     Int64?     Int64?   
─────┼────────────────────────────────
   1 │         5          1         4
   2 │         6          2         4</code></pre><p><code>combine</code> treats each columns in <code>cols</code> individually, thus, a function can be applied to each column by <code>cols =&gt; fun</code> form. <code>combine</code> normalises <code>cols =&gt; funs</code> to <code>col1 =&gt; funs</code>, <code>col2 =&gt; funs</code>, ..., where <code>col1</code> refers to the first column in the column selector <code>cols</code>, <code>col2</code> refers to the second one, .... When <code>col =&gt; funs</code> is passed to the function where <code>col</code> refers to a single column, <code>combine</code> normalises it as <code>col =&gt; fun1</code>, <code>col =&gt; fun2</code>, ..., where <code>fun1</code>, <code>fun2</code>,... are the first, second, ... functions in passed <code>funs</code>.</p><p>Any reduction on multiple columns should be go through a <code>byrow</code> approach.</p><p>In special cases, where users like to apply a multivariate function on a set of columns, the columns which are going to be the argument of the multivariate function must be passed as a Tuple of column names or column indices.</p><pre><code class="language-julia-repl hljs">julia&gt; ds = Dataset(g = [1,1,1,2,2,2],
            x1 = [1.2, 2.3, 1.3, 2.4, 4.5, 5.1],
            x2 = [11, 12.0, 11.0, 12.3, 14.5, 16.9])
6×3 Dataset
Row │ g         x1        x2       
    │ identity  identity  identity
    │ Int64?    Float64?  Float64?
────┼──────────────────────────────
  1 │        1       1.2      11.0
  2 │        1       2.3      12.0
  3 │        1       1.3      11.0
  4 │        2       2.4      12.3
  5 │        2       4.5      14.5
  6 │        2       5.1      16.9

julia&gt; combine(gatherby(ds, 1, isgathered=true), (2,3)=&gt;cor)
2×2 Dataset
Row │ g         cor_x1_x2
    │ identity  identity  
    │ Int64?    Float64?  
────┼─────────────────────
  1 │        1   0.996616
  2 │        2   0.944252
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../grouping/">« Group observations</a><a class="docs-footer-nextpage" href="../transpose/">Transpose data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 7 August 2023 17:09">Monday 7 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
